/*! mosfell Tuesday, April 15th, 2014, 6:44:17 PM */"use strict";var forEach=function(a,b){for(var c=0;c<a.length;c++)b(a[c],c,a)},$1=document.querySelector,AjaxReq=function(a,b,c){var d;return window.XMLHttpRequest?d=new XMLHttpRequest:window.ActiveXObject&&(d=new ActiveXObject("Microsoft.XMLHTTP")),d.onreadystatechange=function(a){4===a.currentTarget.readyState&&b(a.currentTarget)},d.open(c||"GET",a,!0),d.send(null),d},body=document.querySelector("body");body.className+=(""!=body.className?" ":"")+"js-ready";var csvPreview=function(a){{var b=$(a);$("#"+b.attr("data-preview-in")||"csv_preview"),$('<select class="header-select"></select>'),b.closest("form").find("[name=csv_columns_list]")}this.init(a)};PreviewCSV.autoInit=function(){var a=$("#file_csv");a.length&&new PreviewCSV($("#file_csv"))},$.extend(csvPreview,{init:function(){for(field in defaultHeaderFields)defaultHeaderSelect.append($("<option />").val(defaultHeaderFields[field].key).text(defaultHeaderFields[field].value));defaultHeaderSelect.append($("<option/>").val("skip").text("(Don't import this)")),input.change(function(){if(previewIn){previewIn.html(""),previewIn.append($('<p class="contacts-count"><span class="number"></span> <span class="words"></span></p>')),previewIn.append($("<p><strong>Please, check if the columns are correct.</strong> If not, pick the correct one for each line.</p>")),csvPreviewTable=$('<table class="csv-preview-table"></table>').appendTo(previewIn),csvPreviewTable.append($('<thead><tr><th class="first-line">First line<span class="help rock">(confirm the fields are correctly applied)</span></th><th colspan="5">Other lines</th></tr></thead>'));var a=function(){var a="";for(field in currentHeaderFields)a+=(""==a?"":",")+currentHeaderFields[field].key;columnListEl.val(a)};a(),input.parse({config:{header:!1,dynamicTyping:!1,preview:0},complete:function(b){console.log("Completed CSV file parsing");var c=[],d=csvPreviewTable.append($("tbody")),e=previewIn.find(".contacts-count"),f=b.results.length;e.find(".number").html(f),e.find(".words").html(" "+(1!=f?"items detected":"item detected"));for(var g=0;g<b.results.length&&previewLimit>g;g++)!function(b){for(var e=0;e<b.length;e++)!function(b){if(0===g){var f=c[e]=$("<tr></tr>").appendTo(d),h=$("<th></th>"),i=defaultHeaderSelect.clone();h.append($("<span />").html(""==b?'<span class="empty">empty</span>':b)),h.append(i),i.val(defaultHeaderFields[e].key),i.attr("data-index",e),i.change(function(){currentHeaderFields[i.attr("data-index")]={key:i.val(),value:i.html()},a()}),f.append(h)}else c[e].append($("<td></td>").html(""==b?'<span class="empty">empty</span>':b))}(b[e])}(b.results[g])}})}})}}),$(PreviewCSV.autoInit);